---
import Description from '../components/Description.astro'
import Title from '../components/Title.astro'
import Layout from '../layouts/Layout.astro'
import { releases } from '../components/download/release-data.astro'
import PlatformDownload from '../components/download/PlatformDownload.astro'

import { library, icon } from '@fortawesome/fontawesome-svg-core'
import {
  faWindows,
  faLinux,
  faApple,
  faGithub,
} from '@fortawesome/free-brands-svg-icons'
import { Lock, ExternalLink } from 'lucide-astro'

library.add(faWindows, faLinux, faApple, faGithub)
const windowsIcon = icon({ prefix: 'fab', iconName: 'windows' })
const linuxIcon = icon({ prefix: 'fab', iconName: 'linux' })
const appleIcon = icon({ prefix: 'fab', iconName: 'apple' })
const githubIcon = icon({ prefix: 'fab', iconName: 'github' })
---

<Layout title="Download Zen Browser">
  <main class="flex min-h-screen flex-col px-2">
    <div class="container relative mx-auto max-w-5xl py-12">
      <div class="my-12 flex flex-col gap-4 text-center">
        <Title>Download Zen</Title>
        <Description class="mx-auto max-w-2xl">
          Start your journey to a more mindful internet experience with Zen
          Browser. Choose your platform below to get started.
        </Description>
        <Description id="twilight-info" class="mx-auto hidden max-w-2xl">
          <strong>Twilight Mode:</strong> You're currently in Twilight mode, this
          means you're downloading the latest experimental features and updates.
        </Description>
      </div>

      <!-- Platform selector -->
      <div class="mb-12 flex justify-center">
        <div class="inline-flex rounded-full bg-subtle p-1.5">
          <button
            class="platform-selector rounded-full px-5 py-2.5 transition-all duration-300 data-[active='true']:bg-subtle"
            data-platform="mac"
          >
            <span class="flex items-center gap-2">
              <Fragment set:html={appleIcon.html} />
              <span>macOS</span>
            </span>
          </button>
          <button
            class="platform-selector rounded-full px-5 py-2.5 transition-all duration-300 data-[active='true']:bg-subtle"
            data-platform="windows"
          >
            <span class="flex items-center gap-2">
              <Fragment set:html={windowsIcon.html} />
              <span>Windows</span>
            </span>
          </button>
          <button
            class="platform-selector rounded-full px-5 py-2.5 transition-all duration-300 data-[active='true']:bg-subtle"
            data-platform="linux"
          >
            <span class="flex items-center gap-2">
              <Fragment set:html={linuxIcon.html} />
              <span>Linux</span>
            </span>
          </button>
        </div>
      </div>

      <!-- Download Cards -->
      <div
        class="relative mb-16 overflow-hidden rounded-3xl border border-subtle p-8 shadow-xl backdrop-blur-sm md:p-10"
      >
        <!-- Decorative gradient -->
        <div
          class="decorative-gradient absolute inset-0 -z-10 bg-gradient-to-br from-coral/5 via-transparent to-subtle data-[twilight='true']:from-zen-blue/5 data-[twilight='true']:via-transparent data-[twilight='true']:to-subtle"
        >
        </div>

        <!-- MacOS Download -->
        <PlatformDownload
          platform="mac"
          icon={appleIcon.html}
          title="MacOS Download"
          description="Universal binary for Apple Silicon (M1/M2/M3) and Intel Macs.<br />Requires macOS 11.0 or later."
          releases={releases.macos}
        />
        <!-- Windows Download -->
        <PlatformDownload
          platform="windows"
          icon={windowsIcon.html}
          title="Windows Download"
          description="For Windows 10 and Windows 11.<br />Both 64-bit and ARM64 installers available."
          releases={releases.windows}
        />

        <!-- Linux Download -->
        <PlatformDownload
          platform="linux"
          icon={linuxIcon.html}
          title="Linux Download"
          description="Available in multiple formats for different Linux distributions. Choose the option that best fits your system."
          releases={releases.linux}
        />
      </div>

      <!-- Additional resources -->
      <section class="mb-16">
        <h2 class="mb-8 text-center text-2xl font-medium">
          Additional Resources
        </h2>

        <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
          <a
            href="https://github.com/zen-browser"
            class="group rounded-2xl border border-subtle p-6 transition-all duration-300 hover:border-coral hover:border-opacity-20 hover:shadow-lg hover:shadow-coral/5"
          >
            <div class="flex items-start justify-between">
              <div>
                <h3 class="mb-2 text-xl font-medium">Source Code</h3>
                <p class="text-muted-foreground">
                  Explore Zen Browser's source code on GitHub. Contribute to the
                  project or build your own version.
                </p>
              </div>
              <div
                class="grid aspect-square h-12 w-12 place-items-center rounded-xl border border-subtle transition-all duration-300 hover:bg-coral hover:bg-opacity-10 group-hover:border-coral group-hover:border-opacity-10"
              >
                <div class="text-muted-foreground group-hover:text-coral">
                  <Fragment set:html={githubIcon.html} />
                </div>
              </div>
            </div>
          </a>

          <a
            href="https://docs.zen-browser.app"
            class="group rounded-2xl border border-subtle p-6 transition-all duration-300 hover:border-coral hover:border-opacity-20 hover:shadow-lg hover:shadow-coral/5"
          >
            <div class="flex items-start justify-between">
              <div>
                <h3 class="mb-2 text-xl font-medium">Documentation</h3>
                <p class="text-muted-foreground">
                  Access comprehensive documentation, guides, and tutorials for
                  Zen Browser.
                </p>
              </div>
              <div
                class="rounded-xl border border-subtle p-3 transition-all duration-300 hover:bg-coral hover:bg-opacity-10 group-hover:border-coral group-hover:border-opacity-20"
              >
                <ExternalLink class="h-5 w-5 group-hover:text-coral" />
              </div>
            </div>
          </a>
        </div>
      </section>

      <!-- Security Notice -->
      <div
        class="bg-opaicty-10 grid grid-cols-[auto,1fr] gap-4 rounded-2xl border border-subtle bg-subtle p-6"
      >
        <div class="h-fit rounded-xl bg-subtle p-3">
          <Lock class="h-5 w-5" />
        </div>

        <div>
          <h3 class="mb-2 text-lg font-medium">Verified & Secure Downloads</h3>
          <p class="text-muted-foreground">
            All Zen Browser downloads are signed and verified for your security.
            We recommend downloading directly from our official website or
            GitHub repository. If your download seems broken or gets flagged by
            your antivirus, please
            <a
              href="https://github.com/zen-browser/desktop/issues/new/choose"
              class="text-accent ml-1 underline">report it to us</a
            >.
          </p>
        </div>
      </div>
    </div>
  </main>
</Layout>

<script>
  // Handle platform selection
  const platformButtons = document.querySelectorAll('.platform-selector')
  const platformSections = document.querySelectorAll('.platform-section')

  // Function to detect OS and select appropriate platform
  function detectOS() {
    const userAgent = window.navigator.userAgent
    let detectedOS = 'mac' // Default to macOS

    if (userAgent.indexOf('Windows') !== -1) {
      detectedOS = 'windows'
    } else if (userAgent.indexOf('Linux') !== -1) {
      detectedOS = 'linux'
    }

    return detectedOS
  }

  // Initialize platform based on user's OS
  function initializePlatform() {
    const detectedOS = detectOS()
    selectPlatform(detectedOS)
  }

  // Function to select a platform
  function selectPlatform(platform: string) {
    // Update button styling
    platformButtons.forEach((button) => {
      const buttonPlatform = button.getAttribute('data-platform')
      if (buttonPlatform === platform) {
        button.setAttribute('data-active', 'true')
      } else {
        button.setAttribute('data-active', 'false')
      }
    })

    // Show/hide platform sections
    platformSections.forEach((section) => {
      if (section.id === `${platform}-downloads`) {
        section.classList.remove('hidden')
      } else {
        section.classList.add('hidden')
      }
    })
  }

  // Handle platform button clicks
  platformButtons.forEach((button) => {
    button.addEventListener('click', () => {
      const platform = button.getAttribute('data-platform') ?? ''
      selectPlatform(platform)
    })
  })

  // Check for twilight mode
  function checkTwilightMode() {
    const urlParams = new URLSearchParams(window.location.search)
    const isTwilight = urlParams.has('twilight')

    if (isTwilight) {
      // Apply twilight mode to all relevant elements
      const coralElements = document.querySelectorAll(
        '.download-browser-logo, .release-type-tag, .decorative-gradient, .download-link, .download-arrow-icon, .download-card__icon'
      )
      coralElements.forEach((element) => {
        element.setAttribute('data-twilight', 'true')
      })

      const twilightInfoElem = document.getElementById('twilight-info')
      twilightInfoElem?.classList.remove('hidden')

      // Replace all download links with twilight versions
      const downloadLinks = document.querySelectorAll('a[id$="-download"]')
      downloadLinks.forEach((link) => {
        if (!link.id.includes('beta')) {
          const href = link.getAttribute('href')
          if (href && href.includes('/latest/download/')) {
            const twilightHref = href.replace(
              '/latest/download/',
              '/download/twilight/'
            )
            link.setAttribute('href', twilightHref)
          }
        }
      })

      // Update UI to show twilight mode with animation
      const titleElem = document.querySelector('h1')
      if (titleElem) {
        const zenText = titleElem.innerHTML
        titleElem.innerHTML = zenText.replace('Zen', 'Twilight')
      }

      const tags = document.querySelectorAll('.release-type-tag')
      tags.forEach((tag) => {
        tag.innerHTML = tag.innerHTML.replace('Beta', 'Twilight')
      })
    }
  }

  // Initialize the page
  initializePlatform()
  checkTwilightMode()
</script>

<style is:global>
  /* Download card icon */
  .download-card__icon {
    @apply flex h-10 w-10 items-center justify-center rounded-full bg-subtle p-2 text-coral data-[twilight='true']:text-zen-blue;
  }

  /* Make FontAwesome icons match size */
  .download-card__icon svg {
    width: 1.5rem;
    height: 1.5rem;
  }
</style>

<style is:global>
  .os-icon svg {
    height: 3rem;
    width: 3rem;
  }
</style>
