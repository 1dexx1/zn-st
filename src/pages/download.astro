---
import Description from '../components/Description.astro'
import Title from '../components/Title.astro'
import Layout from '../layouts/Layout.astro'
import DownloadCard from '../components/download/ButtonCard.astro'
import { releases } from '../components/download/release-data.astro'

import { library, icon } from '@fortawesome/fontawesome-svg-core'
import {
  faWindows,
  faLinux,
  faApple,
  faGithub,
} from '@fortawesome/free-brands-svg-icons'
import { Lock, Download as DownloadIcon, ExternalLink } from 'lucide-astro'

library.add(faWindows, faLinux, faApple, faGithub)
const windowsIcon = icon({ prefix: 'fab', iconName: 'windows' })
const linuxIcon = icon({ prefix: 'fab', iconName: 'linux' })
const appleIcon = icon({ prefix: 'fab', iconName: 'apple' })
const githubIcon = icon({ prefix: 'fab', iconName: 'github' })
---

<Layout title="Download Zen Browser">
  <main class="flex min-h-screen flex-col px-2">
    <div class="container relative mx-auto max-w-5xl py-12">
      <!-- Background elements -->
      <!-- <div
        class="gradient-blur gradient-blur--primary absolute -top-[10%] right-[5%] -z-10 h-[25vw] w-[25vw] opacity-[0.12]"
      >
      </div>
      <div
        class="gradient-blur gradient-blur--accent absolute bottom-[20%] left-[10%] -z-10 h-[20vw] w-[20vw] opacity-[0.12]"
      >
      </div> -->

      <div class="my-16 animate-fadeIn text-center">
        <!-- <div
          class="mx-auto my-6 inline-flex items-center justify-center rounded-full border border-coral p-2 px-4 text-dark"
        >
          <DownloadIcon class="mr-2 h-4 w-4" />
          <span class="text-sm font-medium">Get Started</span>
        </div> -->

        <Title>Download Zen</Title>
        <Description class="mx-auto max-w-2xl">
          Start your journey to a more mindful internet experience with Zen
          Browser. Choose your platform below to get started.
        </Description>
      </div>

      <!-- Platform selector -->
      <div class="mb-12 flex justify-center">
        <div class="inline-flex rounded-full bg-subtle p-1.5">
          <button
            class="platform-selector rounded-full px-5 py-2.5 transition-all duration-300 data-[active='true']:bg-subtle"
            data-platform="mac"
          >
            <span class="flex items-center gap-2">
              <Fragment set:html={appleIcon.html} />
              <span>macOS</span>
            </span>
          </button>
          <button
            class="platform-selector rounded-full px-5 py-2.5 transition-all duration-300 data-[active='true']:bg-subtle"
            data-platform="windows"
          >
            <span class="flex items-center gap-2">
              <Fragment set:html={windowsIcon.html} />
              <span>Windows</span>
            </span>
          </button>
          <button
            class="platform-selector rounded-full px-5 py-2.5 transition-all duration-300 data-[active='true']:bg-subtle"
            data-platform="linux"
          >
            <span class="flex items-center gap-2">
              <Fragment set:html={linuxIcon.html} />
              <span>Linux</span>
            </span>
          </button>
        </div>
      </div>

      <!-- Download Cards -->
      <div
        class="relative mb-16 overflow-hidden rounded-3xl border border-subtle p-8 shadow-xl backdrop-blur-sm md:p-10"
      >
        <!-- Decorative gradient -->
        <div
          class="absolute inset-0 -z-10 bg-gradient-to-br from-coral/5 via-transparent to-subtle"
        >
        </div>

        <!-- MacOS Download -->
        <div id="mac-downloads" class="platform-section">
          <div class="items-center gap-8 md:flex">
            <div class="mb-8 md:mb-0 md:w-2/3">
              <div class="mb-4 flex items-center gap-3">
                <div class="download-card__icon">
                  <Fragment set:html={appleIcon.html} />
                </div>
                <h3 class="text-2xl font-medium">macOS Download</h3>
              </div>
              <p class="text-muted-foreground mb-6">
                Universal binary for Apple Silicon (M1/M2/M3) and Intel Macs. <br
                />
                Requires macOS 11.0 or later.
              </p>
              <div class="space-y-4">
                {
                  Object.entries(releases.macos).map(
                    ([variant, releaseNote]) => (
                      <DownloadCard
                        label={releaseNote.label}
                        href={releaseNote.link}
                        variant={variant}
                      />
                    )
                  )
                }
              </div>
            </div>
            <div class="flex justify-center md:w-1/3">
              <div class="relative h-60 w-60">
                <div class="absolute inset-0 flex items-center justify-center">
                  <svg
                    width="180"
                    height="180"
                    viewBox="0 0 180 180"
                    class="animate-float"
                  >
                    <circle
                      cx="90"
                      cy="90"
                      r="88"
                      fill="none"
                      stroke="hsl(var(--primary)/0.2)"
                      stroke-width="1"></circle>
                    <circle
                      cx="90"
                      cy="90"
                      r="80"
                      fill="none"
                      stroke="hsl(var(--primary)/0.3)"
                      stroke-width="1"></circle>
                    <circle
                      cx="90"
                      cy="90"
                      r="60"
                      fill="none"
                      stroke="hsl(var(--primary)/0.4)"
                      stroke-width="2"></circle>
                  </svg>
                </div>
                <div
                  class="-sm:hidden absolute left-1/2 top-1/2 flex h-24 w-24 -translate-x-1/2 -translate-y-1/2 transform items-center justify-center rounded-[28px] border border-subtle backdrop-blur-sm"
                >
                  <div
                    class="os-icon flex h-12 w-12 items-center justify-center text-coral"
                  >
                    <Fragment set:html={appleIcon.html} />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Windows Download -->
        <div id="windows-downloads" class="platform-section hidden">
          <div class="items-center gap-8 md:flex">
            <div class="mb-8 md:mb-0 md:w-2/3">
              <div class="mb-4 flex items-center gap-3">
                <div class="download-card__icon">
                  <Fragment set:html={windowsIcon.html} />
                </div>
                <h3 class="text-2xl font-medium">Windows Download</h3>
              </div>
              <p class="text-muted-foreground mb-6">
                For Windows 10 and Windows 11. <br />
                Both 64-bit (recommended) and 32-bit installers available.
              </p>
              <div class="space-y-4">
                {
                  Object.entries(releases.windows).map(
                    ([variant, releaseNote]) => (
                      <DownloadCard
                        label={releaseNote.label}
                        href={releaseNote.link}
                        variant={variant}
                      />
                    )
                  )
                }
              </div>
            </div>
            <div class="flex justify-center md:w-1/3">
              <div class="relative h-60 w-60">
                <div class="absolute inset-0 flex items-center justify-center">
                  <svg
                    width="180"
                    height="180"
                    viewBox="0 0 180 180"
                    class="animate-float"
                  >
                    <rect
                      x="35"
                      y="35"
                      width="110"
                      height="110"
                      rx="8"
                      fill="none"
                      stroke="hsl(var(--primary)/0.2)"
                      stroke-width="1"></rect>
                    <rect
                      x="45"
                      y="45"
                      width="90"
                      height="90"
                      rx="6"
                      fill="none"
                      stroke="hsl(var(--primary)/0.3)"
                      stroke-width="1"></rect>
                    <rect
                      x="60"
                      y="60"
                      width="60"
                      height="60"
                      rx="4"
                      fill="none"
                      stroke="hsl(var(--primary)/0.4)"
                      stroke-width="2"></rect>
                  </svg>
                </div>
                <div
                  class="sm-hidden absolute left-1/2 top-1/2 flex h-24 w-24 -translate-x-1/2 -translate-y-1/2 transform items-center justify-center rounded-[28px] border border-subtle backdrop-blur-sm"
                >
                  <div
                    class="os-icon flex items-center justify-center text-coral"
                  >
                    <Fragment set:html={windowsIcon.html} />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Linux Download -->
        <!-- Linux Download -->
        <div id="linux-downloads" class="platform-section hidden">
          <div class="items-center gap-8 md:flex">
            <div class="mb-8 md:mb-0 md:w-2/3">
              <div class="mb-4 flex items-center gap-3">
                <div class="download-card__icon">
                  <Fragment set:html={linuxIcon.html} />
                </div>
                <h3 class="text-2xl font-medium">Linux Download</h3>
              </div>
              <p class="text-muted-foreground mb-6">
                Available in multiple formats for different Linux distributions.
                Choose the option that best fits your system.
              </p>

              <!-- Package managers first - most user-friendly -->
              <div class="mb-6">
                <h4
                  class="mb-4 border-b border-subtle pb-2 text-lg font-medium"
                >
                  Package Managers
                </h4>
                <div class="space-y-4">
                  <DownloadCard
                    label="Flathub"
                    href={releases.linux.flathub.all.link}
                    variant="flathub"
                  />
                </div>
              </div>

              <!-- AppImages second - also user-friendly -->
              <div class="mb-6">
                <h4
                  class="mb-4 border-b border-subtle pb-2 text-lg font-medium"
                >
                  AppImage (Portable)
                </h4>
                <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
                  <DownloadCard
                    label="x86_64 (64-bit)"
                    href={releases.linux.x86_64.appImage.link}
                    variant="x86_64-appImage"
                  />
                  <DownloadCard
                    label="ARM64"
                    href={releases.linux.aarch64.appImage.link}
                    variant="aarch64-appImage"
                  />
                </div>
              </div>

              <!-- Tarballs last - for advanced users -->
              <div>
                <h4
                  class="mb-4 border-b border-subtle pb-2 text-lg font-medium"
                >
                  Tarball (Manual Install)
                </h4>
                <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
                  <DownloadCard
                    label="x86_64 (64-bit)"
                    href={releases.linux.x86_64.tarball.link}
                    variant="x86_64-tarball"
                  />
                  <DownloadCard
                    label="ARM64"
                    href={releases.linux.aarch64.tarball.link}
                    variant="aarch64-tarball"
                  />
                </div>
              </div>
            </div>

            <div class="flex justify-center md:w-1/3">
              <div class="relative h-60 w-60">
                <div class="absolute inset-0 flex items-center justify-center">
                  <svg
                    width="180"
                    height="180"
                    viewBox="0 0 180 180"
                    class="animate-float"
                  >
                    <polygon
                      points="90,30 30,150 150,150"
                      fill="none"
                      stroke="hsl(var(--primary)/0.2)"
                      stroke-width="1"></polygon>
                    <polygon
                      points="90,45 45,140 135,140"
                      fill="none"
                      stroke="hsl(var(--primary)/0.3)"
                      stroke-width="1"></polygon>
                    <polygon
                      points="90,60 60,130 120,130"
                      fill="none"
                      stroke="hsl(var(--primary)/0.4)"
                      stroke-width="2"></polygon>
                  </svg>
                </div>
                <div
                  class="-sm:hidden absolute left-1/2 top-1/2 flex h-24 w-24 -translate-x-1/2 -translate-y-1/2 transform items-center justify-center rounded-[28px] border border-subtle backdrop-blur-sm"
                >
                  <div
                    class="os-icon flex items-center justify-center text-coral"
                  >
                    <Fragment set:html={linuxIcon.html} />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Additional resources -->
      <section class="mb-16">
        <h2 class="mb-8 text-center text-2xl font-medium">
          Additional Resources
        </h2>

        <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
          <a
            href="https://github.com/zen-browser"
            class="group rounded-2xl border border-subtle p-6 transition-all duration-300 hover:border-coral hover:border-opacity-20 hover:shadow-lg hover:shadow-coral/5"
          >
            <div class="flex items-start justify-between">
              <div>
                <h3 class="mb-2 text-xl font-medium">Source Code</h3>
                <p class="text-muted-foreground">
                  Explore Zen Browser's source code on GitHub. Contribute to the
                  project or build your own version.
                </p>
              </div>
              <div
                class="grid aspect-square h-12 w-12 place-items-center rounded-xl border border-subtle transition-all duration-300 hover:bg-coral hover:bg-opacity-10 group-hover:border-coral group-hover:border-opacity-10"
              >
                <div class="text-muted-foreground group-hover:text-coral">
                  <Fragment set:html={githubIcon.html} />
                </div>
              </div>
            </div>
          </a>

          <a
            href="https://docs.zen-browser.app"
            class="group rounded-2xl border border-subtle p-6 transition-all duration-300 hover:border-coral hover:border-opacity-20 hover:shadow-lg hover:shadow-coral/5"
          >
            <div class="flex items-start justify-between">
              <div>
                <h3 class="mb-2 text-xl font-medium">Documentation</h3>
                <p class="text-muted-foreground">
                  Access comprehensive documentation, guides, and tutorials for
                  Zen Browser.
                </p>
              </div>
              <div
                class="rounded-xl border border-subtle p-3 transition-all duration-300 hover:bg-coral hover:bg-opacity-10 group-hover:border-coral group-hover:border-opacity-20"
              >
                <ExternalLink class="h-5 w-5 group-hover:text-coral" />
              </div>
            </div>
          </a>
        </div>
      </section>

      <!-- Security Notice -->
      <div
        class="grid grid-cols-[auto,1fr] gap-4 rounded-2xl border border-subtle p-6"
      >
        <div class="h-fit rounded-xl bg-subtle p-3">
          <Lock class="h-5 w-5" />
        </div>

        <div>
          <h3 class="mb-2 text-lg font-medium">Verified & Secure Downloads</h3>
          <p class="text-muted-foreground">
            All Zen Browser downloads are signed and verified for your security.
            We recommend downloading directly from our official website or
            GitHub repository. If your download seems broken or gets flagged by
            your antivirus, please
            <a
              href="https://github.com/zen-browser/desktop/issues/new/choose"
              class="text-accent ml-1 underline">report it to us</a
            >.
          </p>
        </div>
      </div>
    </div>
  </main>
</Layout>

<script>
  // Handle platform selection
  const platforms = ['mac', 'windows', 'linux']
  const platformButtons = document.querySelectorAll('.platform-selector')
  const platformSections = document.querySelectorAll('.platform-section')

  // Function to detect OS and select appropriate platform
  function detectOS() {
    const userAgent = window.navigator.userAgent
    let detectedOS = 'mac' // Default to macOS

    if (userAgent.indexOf('Windows') !== -1) {
      detectedOS = 'windows'
    } else if (userAgent.indexOf('Linux') !== -1) {
      detectedOS = 'linux'
    }

    return detectedOS
  }

  // Initialize platform based on user's OS
  function initializePlatform() {
    const detectedOS = detectOS()
    selectPlatform(detectedOS)
  }

  // Function to select a platform
  function selectPlatform(platform: string) {
    // Update button styling
    platformButtons.forEach((button) => {
      const buttonPlatform = button.getAttribute('data-platform')
      if (buttonPlatform === platform) {
        button.setAttribute('data-active', 'true')
      } else {
        button.setAttribute('data-active', 'false')
      }
    })

    // Show/hide platform sections
    platformSections.forEach((section) => {
      if (section.id === `${platform}-downloads`) {
        section.classList.remove('hidden')
      } else {
        section.classList.add('hidden')
      }
    })
  }

  // Handle platform button clicks
  platformButtons.forEach((button) => {
    button.addEventListener('click', () => {
      const platform = button.getAttribute('data-platform') ?? ''
      selectPlatform(platform)
    })
  })

  // Check for twilight mode
  function checkTwilightMode() {
    const urlParams = new URLSearchParams(window.location.search)
    const isTwilight = urlParams.has('twilight')

    if (isTwilight) {
      // Replace all download links with twilight versions
      const downloadLinks = document.querySelectorAll('a[id$="-download"]')
      downloadLinks.forEach((link) => {
        if (!link.id.includes('beta')) {
          const href = link.getAttribute('href')
          if (href && href.includes('/latest/download/')) {
            const twilightHref = href.replace(
              '/latest/download/',
              '/download/twilight/'
            )
            link.setAttribute('href', twilightHref)
          }
        }
      })

      // Update UI to show twilight mode
      const titleElem = document.querySelector('h1')
      if (titleElem) {
        titleElem.innerHTML = titleElem.innerHTML.replace('Zen', 'Twilight')
      }

      const tags = document.querySelectorAll('.release-type-tag')
      tags.forEach((tag) => {
        tag.innerHTML = tag.innerHTML.replace('Beta', 'Twilight')
      })
    }
  }

  // Initialize the page
  document.addEventListener('DOMContentLoaded', () => {
    initializePlatform()
    checkTwilightMode()
  })
</script>

<style>
  /* Floating animation */
  @keyframes float {
    0% {
      transform: translateY(0px);
    }
    50% {
      transform: translateY(-10px);
    }
    100% {
      transform: translateY(0px);
    }
  }

  .animate-float {
    animation: float 6s ease-in-out infinite;
  }

  /* Fade in animation */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fadeIn {
    animation: fadeIn 0.6s ease-out forwards;
  }

  /* Gradient blur */
  .gradient-blur {
    position: absolute;
    border-radius: 50%;
    filter: blur(70px);
  }

  .gradient-blur--primary {
    background: var(--color-primary, #3b82f6);
  }

  .gradient-blur--accent {
    background: var(--color-accent, #f97316);
  }

  /* Download card icon */
  .download-card__icon {
    @apply flex h-10 w-10 items-center justify-center rounded-full bg-subtle p-2 text-coral;
  }

  /* Make FontAwesome icons match size */
  .download-card__icon svg {
    width: 1.5rem;
    height: 1.5rem;
  }
</style>

<style is:global>
  .os-icon svg {
    height: 3rem;
    width: 3rem;
  }
</style>
